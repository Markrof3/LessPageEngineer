# LessPageEngineer

æµè§ˆå™¨è°ƒåº¦ï¼Œä»¥åŠéƒ¨åˆ†CDPåè®®æ”¯æŒï¼ŒåŸºäºDrissionPageäºŒå¼€

## ç›®å½•

- [ä½¿ç”¨é¡»çŸ¥](#ä½¿ç”¨é¡»çŸ¥)
- [å¦‚ä½•ä½¿ç”¨](#å¦‚ä½•ä½¿ç”¨)
  - [æœåŠ¡ç«¯](#æœåŠ¡ç«¯)
  - [å®¢æˆ·ç«¯](#å®¢æˆ·ç«¯)
- [å‚æ•°è¯´æ˜](#å‚æ•°è¯´æ˜)
  - [åŸºç¡€å‚æ•°](#åŸºç¡€å‚æ•°)
  - [key ç¼“å­˜æœºåˆ¶](#key-ç¼“å­˜æœºåˆ¶)
  - [session_id ä¼šè¯ä¿æŒ](#session_id-ä¼šè¯ä¿æŒ)
  - [run_time ä¸ run_time_enable çš„åŒºåˆ«](#run_time-ä¸-run_time_enable-çš„åŒºåˆ«)
  - [å…ƒç´ åŒ¹é…è¯­æ³•](#å…ƒç´ åŒ¹é…è¯­æ³•)
  - [wait_urls è¯¦è§£](#wait_urls-è¯¦è§£)
  - [ensure_eles è¯¦è§£](#ensure_eles-è¯¦è§£)
  - [script è¯¦è§£](#script-è¯¦è§£)
- [è¿”å›å€¼ç»“æ„](#è¿”å›å€¼ç»“æ„)
- [Web UI ç¼“å­˜ç®¡ç†](#web-ui-ç¼“å­˜ç®¡ç†)

---

## ä½¿ç”¨é¡»çŸ¥

**å…è®¸ä»»ä½•ä¸ªäººä»¥å­¦ä¹ æˆ–ä¸ªäººéç›ˆåˆ©ä¸ºç›®çš„ä½¿ç”¨ã€ä¿®æ”¹ä¸åˆ†å‘æœ¬é¡¹ç›®çš„æºä»£ç æˆ–è¡ç”Ÿä½œå“ã€‚**

ä¸ªäººæˆ–ç»„ç»‡è‹¥éœ€å°†æœ¬é¡¹ç›®ç”¨äºå•†ä¸šç”¨é€”ï¼ˆåŒ…æ‹¬ä½†ä¸é™äºé”€å”®ã€åµŒå…¥ä»˜è´¹äº§å“ã€æä¾›å•†ä¸šåŒ–æœåŠ¡ç­‰ï¼‰ï¼Œ**å¿…é¡»äº‹å…ˆè·å¾—ç‰ˆæƒæŒæœ‰äººçš„æ˜ç¡®ä¹¦é¢æˆæƒ**ï¼Œå¦åˆ™ä¸€å¾‹è§†ä¸ºä¾µæƒã€‚

### âœ… ä½¿ç”¨å‰æ

ä½¿ç”¨æœ¬é¡¹ç›®å³è¡¨ç¤ºæ‚¨å·²é˜…è¯»å¹¶æ¥å—ä»¥ä¸‹æ¡æ¬¾ã€‚ä¸€æ—¦åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç”Ÿ**ä»»ä½•è¿åä¸‹è¿°æ¡æ¬¾çš„è¡Œä¸ºï¼Œæœ¬æˆæƒå°†è‡ªåŠ¨ç»ˆæ­¢ï¼Œä¸”ç‰ˆæƒæŒæœ‰äººä¿ç•™è¿½ç©¶æ³•å¾‹è´£ä»»çš„æƒåˆ©**ã€‚

### ğŸš« ç¦æ­¢äº‹é¡¹

1. **ä¸¥ç¦å°† LessPageEngineer åº”ç”¨äºä»»ä½•å¯èƒ½è¿åå½“åœ°æ³•å¾‹æ³•è§„æˆ–å…¬åºè‰¯ä¿—çš„é¡¹ç›®ä¸­ï¼›**
2. **ä¸¥ç¦å°† LessPageEngineer ç”¨äºä»»ä½•å¯èƒ½æŸå®³ä»–äººåˆæ³•æƒç›Šï¼ˆå¦‚éšç§ä¾µçŠ¯ã€æ•°æ®æ»¥ç”¨ã€ä¸æ­£å½“ç«äº‰ç­‰ï¼‰çš„åœºæ™¯ï¼›**
3. **ä¸¥ç¦å°† LessPageEngineer ç”¨äºä»»ä½•å½¢å¼çš„ç½‘ç»œæ”»å‡»ã€æ¶æ„çˆ¬è™«ã€éªšæ‰°ã€æ¬ºè¯ˆæˆ–å…¶ä»–éæ³•è¡Œä¸ºï¼›**
4. **å¿…é¡»éµå®ˆç›®æ ‡ç½‘ç«™çš„ `robots.txt`åè®®åŠç›¸å…³æ³•å¾‹æ³•è§„ï¼Œç¦æ­¢é‡‡é›†ä»»ä½•è¢«æ˜ç¡®ç¦æ­¢è®¿é—®æˆ–æŠ“å–çš„æ•°æ®ï¼›**
5. **ä¸å¾—åˆ©ç”¨æœ¬é¡¹ç›®ä»äº‹ä»»ä½•ä¾µçŠ¯çŸ¥è¯†äº§æƒã€ç ´åç½‘ç»œå®‰å…¨æˆ–æ‰°ä¹±ç¤¾ä¼šç§©åºçš„æ´»åŠ¨ã€‚**

### âš ï¸ è´£ä»»å£°æ˜

- ä½¿ç”¨æœ¬é¡¹ç›®æ‰€äº§ç”Ÿçš„**ä¸€åˆ‡è¡Œä¸ºä¸åæœå‡ç”±ä½¿ç”¨è€…è‡ªè¡Œæ‰¿æ‹…**ï¼›
- å› ä½¿ç”¨ LessPageEngineer æ‰€å¼•å‘çš„æ³•å¾‹çº çº·ã€ç»æµæŸå¤±ã€æŠ€æœ¯æ•…éšœæˆ–å…¶ä»–ä»»ä½•é—®é¢˜ï¼Œ**ç‰ˆæƒæŒæœ‰äººä¸æ‰¿æ‹…ä»»ä½•ç›´æ¥æˆ–é—´æ¥è´£ä»»**ï¼›
- æœ¬é¡¹ç›®æŒ‰"ç°çŠ¶"ï¼ˆAS ISï¼‰æä¾›ï¼Œ**ä¸ä¿è¯å…¶é€‚ç”¨äºä»»ä½•ç‰¹å®šç”¨é€”ï¼Œäº¦ä¸å¯¹æ½œåœ¨ç¼ºé™·æ‰€å¯¼è‡´çš„æŸå¤±è´Ÿä»»ä½•è´£ä»»**ï¼›
- ç‰ˆæƒæŒæœ‰äºº**ä¸å¯¹å› ç¬¬ä¸‰æ–¹ä½¿ç”¨æœ¬é¡¹ç›®è€Œé€ æˆçš„ä»»ä½•æŸå®³æä¾›èµ”å¿æˆ–æŠ€æœ¯æ”¯æŒ**ã€‚

---

## å¦‚ä½•ä½¿ç”¨

**é‡è¦!!!!!**  

é¡¹ç›®ä½¿ç”¨äº†`DrissionPage 4.0.5.6`ç‰ˆæœ¬ï¼Œå¦‚æœä½ å·²ç»è£…äº†`DrissionPage`å¹¶ä¸”ä¸æ˜¯è¿™ä¸ªç‰ˆæœ¬çš„ï¼Œæœ€å¥½åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ¥è¿è¡Œé¡¹ç›®

### æœåŠ¡ç«¯

1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ(å¯é€‰)

   ```bash
   python -m venv LPEEnv
   LPEEnv\Scripts\activate
   ```

2. å®‰è£…Pythonåº“

   ```bash
   pip install -r requirements.txt
   ```

3. åœ¨é¡¹ç›®çš„ä¸Šä¸€å±‚æ–‡ä»¶è·¯å¾„åˆ›å»ºå¯åŠ¨æ–‡ä»¶(ç±»ä¼¼main.py)

   ```python
   from LessPageEngineer.LessPageEngineeringCreator import LessPageEngineeringCreator
   
   less = LessPageEngineeringCreator({
       'TABS_NUM': 1,                        # æ ‡ç­¾é¡µæ•°é‡
       'SERVER_DEFAULT_PORT': 27889,         # æœåŠ¡ç«¯å£
       'MAX_CHROME_TABS_NUM': 5,             # æœ€å¤§æ ‡ç­¾é¡µæ•°é‡
       'MAX_TAB_LIVE_TIME': 60,              # æ ‡ç­¾é¡µæœ€å¤§å­˜æ´»æ—¶é—´
       'MAX_CHROME_LIVE_TIME': 150,          # æµè§ˆå™¨æœ€å¤§å­˜æ´»æ—¶é—´
       'MAX_AFTER_REQUEST_SESSION_TIME': 150,# æ ‡ç­¾ä¼šè¯ä¿å­˜æ—¶é—´
       'EXTENSION_PATHS': [],                # æ’ä»¶è·¯å¾„
       'UPSTREAM': None,                     # ä¸Šæ¸¸ä»£ç†
   })
   less.run()  # å¯åŠ¨æœåŠ¡
   ```

   çœ‹åˆ°ç±»ä¼¼ `---------- æœåŠ¡ç«¯å£: 27889 ç¼“å­˜ä»£ç†: æ—  ä¸Šæ¸¸æ§åˆ¶: ç¦ç”¨ ----------` çš„è¾“å‡ºï¼Œåˆ™è¡¨ç¤ºæ­£å¸¸è¿è¡Œ

### å®¢æˆ·ç«¯

å‘é€è¯·æ±‚è°ƒç”¨æœåŠ¡ç«¯æ¥å£å³å¯

```python
import requests

BASE_URL = 'http://127.0.0.1:27889'

post_data = {
    'url': 'https://www.baidu.com',
    'timeout': 30,
    'script': [
        {'pattern': 'c:#chat-submit-button', 'function': 'click'},
    ],
    'ensure_eles': [{'pattern': 'x://b[contains(text(), "ç½‘é¡µ")]'}],
}

resp = requests.post(f'{BASE_URL}/uploadUrl', json=post_data)
result = resp.json()
print(result)
```

---

## å‚æ•°è¯´æ˜

### åŸºç¡€å‚æ•°

| å‚æ•°                     | ç±»å‹      | è¯´æ˜                                                                                                                         |
| ------------------------ | --------- | ---------------------------------------------------------------------------------------------------------------------------- |
| url                      | string    | æµè§ˆå™¨è¯·æ±‚çš„é“¾æ¥(**å¿…è¦å‚æ•°**)                                                                                               |
| key                      | string    | ç´¢å¼•æµè§ˆå™¨ç¼“å­˜çš„Key                                                                                                          |
| timeout                  | int       | è¶…æ—¶æ—¶é—´(é»˜è®¤60)                                                                                                             |
| fast                     | bool      | å¼ºåˆ¶é¡µé¢çš„åŠ è½½æ¨¡å¼(ä¸ºTrueæ—¶ä¸ºNoneæ¨¡å¼ï¼Œä¸ºFalseæ—¶ä¸ºnormalæ¨¡å¼ï¼Œè¯¦æƒ…è§https://www.drissionpage.cn/ChromiumPage/visit)          |
| key_save                 | bool      | æ˜¯å¦ä¿å­˜Key(é»˜è®¤False)                                                                                                       |
| key_replace              | bool      | æ˜¯å¦æ›¿æ¢Key(é»˜è®¤False)                                                                                                       |
| wait_urls                | list      | éœ€è¦è¿›è¡Œæ•è·/ç½‘ç»œè¯·æ±‚çš„é“¾æ¥åˆ—è¡¨ï¼Œè¯¦æƒ…è§ [wait_urls è¯¦è§£](#wait_urls-è¯¦è§£)                                                    |
| disable_network          | bool      | ç¦æ­¢è¿›è¡Œé¢å¤–çš„ç½‘ç»œè¯·æ±‚ **PS:åœ¨wait_urlsä¸­åŒ¹é…åˆ°çš„é“¾æ¥ä¸ä¼šè¢«ç¦æ­¢**                                                            |
| disable_img_font         | bool      | ç¦æ­¢å›¾ç‰‡ã€cssæ–‡ä»¶åŠ è½½(é»˜è®¤False)                                                                                             |
| ensure_eles              | list      | ç¡®ä¿åŠ è½½çš„å…ƒç´ åˆ—è¡¨ï¼Œè¯¦æƒ…è§ [ensure_eles è¯¦è§£](#ensure_eles-è¯¦è§£)                                                             |
| ensure_all               | bool      | ç¡®ä¿**ensure_eles**ä¸­çš„æ‰€æœ‰å…ƒç´ è¢«æ­£ç¡®åŠ è½½(é»˜è®¤True)                                                                          |
| iframe_ele               | string    | é¡µé¢ä¸­çš„iframe **PS:å½“è¯·æ±‚é“¾æ¥æœ‰iframeæ—¶ï¼Œé˜²æ­¢å› å…ƒç´ åµŒå¥—åœ¨iframeå¯¼è‡´ensure_elesæ— æ³•æ­£å¸¸è¿è¡Œ** (å®éªŒæ€§åŠŸèƒ½)                   |
| iframe_route             | bool      | æ˜¯å¦ç›‘å¬iframeä¸­çš„è¯·æ±‚(é»˜è®¤False)                                                                                            |
| run_time                 | bool      | é¡µé¢æ˜¯å¦éœ€è¦æ‰§è¡ŒæŒ‡å®šçš„jsè¯­å¥æ—¶**å¿…é¡»ä¸ºTrue**                                                                                 |
| script                   | list      | è®©é¡µé¢è¿è¡Œçš„è„šæœ¬ï¼Œè¯¦æƒ…è§ [script è¯¦è§£](#script-è¯¦è§£)                                                                         |
| thread_script            | bool      | scriptæ˜¯å¦ä»¥çº¿ç¨‹æ¨¡å¼å¯åŠ¨(é»˜è®¤False)                                                                                          |
| script_error_reload_page | bool      | scriptæ‰§è¡Œå‡ºé”™æ—¶æ˜¯å¦é‡æ–°åŠ è½½é¡µé¢(é»˜è®¤True,åœ¨thread_scriptæ¨¡å¼ä¸‹å›ºå®šFalse)                                                    |
| run_time_enable          | bool      | æ˜¯å¦è¿è¡Œcdp-Runtime.enable(é»˜è®¤ä¸ºTrue)                                                                                       |
| fail_return              | bool      | ä¸æ»¡è¶³è¿”å›æ¡ä»¶æ—¶ï¼Œæ˜¯å¦è¿”å›å½“å‰é¡µé¢ä»¥åŠå…¶ä»–å‚æ•°é¡¹(é»˜è®¤False)                                                                  |
| cookies                  | bool      | æ˜¯å¦è¿”å›é¡µé¢çš„Cookies(é»˜è®¤False)                                                                                             |
| set_cookies              | dict/list | è®¾ç½®é¡µé¢çš„Cookies                                                                                                            |
| session_storage          | bool      | æ˜¯å¦è¿”å›é¡µé¢çš„session_storage(é»˜è®¤False)                                                                                     |
| set_session_storage      | dict      | è®¾ç½®é¡µé¢çš„session_storage                                                                                                    |
| local_storage            | bool      | æ˜¯å¦è¿”å›é¡µé¢çš„local_storage(é»˜è®¤False)                                                                                       |
| set_local_storage        | dict      | è®¾ç½®é¡µé¢çš„local_storage                                                                                                      |
| clear_cookies            | bool      | æ˜¯å¦éœ€è¦æ¸…ç†æ ‡ç­¾é¡µcookies(é»˜è®¤Trueï¼Œä½¿ç”¨session_idä¿æŒä¼šè¯æ—¶é»˜è®¤False)                                                       |
| new_context              | bool      | æ˜¯å¦éœ€è¦ä»¥æ–°çš„ä¸Šä¸‹æ–‡è¿è¡Œ(é»˜è®¤False)**PS:ä¸åŒçš„ä¸Šä¸‹æ–‡ä»£è¡¨ç€Cookiesä¸å…±äº«,æš‚æ—¶æ²¡æœ‰æµ‹è¯•é¡µé¢ç¼“å­˜æ˜¯å¦å…±äº«**                       |
| session_id               | str       | ä¿æŒæ ‡ç­¾é¡µçš„id **PS:å¿…é¡»ä¸ºstrç±»å‹**                                                                                          |
| init_session             | dict      | åˆå§‹åŒ–ä¿æŒæ ‡ç­¾é¡µçš„å‚æ•°                                                                                                       |
| global_proxy             | string    | è®¾å®šæµè§ˆå™¨**å…¨å±€**ä»£ç†                                                                                                       |
| html                     | bool      | æ˜¯å¦éœ€è¦è¿”å›æµè§ˆå™¨Html(é»˜è®¤False)                                                                                            |
| ua                       | string    | è®¾ç½®æµè§ˆå™¨User-Agent                                                                                                         |
| reset_tcp_connect        | bool      | é‡ç½®æµè§ˆå™¨æ‰€æœ‰TCPè¿æ¥(é»˜è®¤False) **PS:å¯ç”¨ä¼šæå¤§å½±å“è¯·æ±‚é€Ÿåº¦**                                                               |

> **é¡»çŸ¥ï¼š**
>
> - `**` åŒ¹é…é“¾æ¥é€šé…ç¬¦ï¼Œç›¸å½“äºæ­£åˆ™ä¸­çš„ `.*`ï¼Œå³ä»»ä½•å­—ç¬¦
> - **ensure_elesä¸wait_urlsä¸¤è€…éƒ½æœ‰æ—¶ï¼Œensure_elesä½œä¸ºé¡µé¢æ­£ç¡®åŠ è½½çš„è¯„å®šæ ‡å‡†**

---

### key ç¼“å­˜æœºåˆ¶

key ç”¨äºç¼“å­˜é¡µé¢è¯·æ±‚è¿‡ç¨‹ä¸­çš„ç½‘ç»œèµ„æºï¼ˆå¦‚ JSã€CSSã€API å“åº”ç­‰ï¼‰ï¼Œä¸‹æ¬¡è¯·æ±‚ç›¸åŒ key æ—¶å¯ç›´æ¥ä½¿ç”¨ç¼“å­˜ï¼ŒåŠ å¿«é¡µé¢åŠ è½½é€Ÿåº¦ã€‚

**ç¼“å­˜å†…å®¹ï¼š** é¡µé¢åŠ è½½è¿‡ç¨‹ä¸­æ‹¦æˆªåˆ°çš„æ‰€æœ‰ç½‘ç»œè¯·æ±‚çš„å“åº”ï¼ˆURLã€å“åº”å¤´ã€å“åº”ä½“ã€çŠ¶æ€ç ï¼‰

**ç›¸å…³å‚æ•°ï¼š**

| å‚æ•°        | ä½œç”¨                                                                 |
| ----------- | -------------------------------------------------------------------- |
| key         | æŒ‡å®šä½¿ç”¨å“ªä¸ªç¼“å­˜ï¼Œä¼ å…¥å·²å­˜åœ¨çš„ key ä¼šä½¿ç”¨å¯¹åº”ç¼“å­˜                    |
| key_save    | ä¸º True æ—¶ï¼Œå°†æœ¬æ¬¡è¯·æ±‚çš„ç½‘ç»œèµ„æºä¿å­˜ä¸ºç¼“å­˜ï¼ˆkey è‡ªåŠ¨ç”Ÿæˆä¸º URL çš„ Base64ï¼‰ |
| key_replace | ä¸º True æ—¶ï¼Œå¼ºåˆ¶è¦†ç›–å·²å­˜åœ¨çš„ç¼“å­˜                                     |

**ä½¿ç”¨åœºæ™¯ï¼š**
- é¡µé¢ç»“æ„å›ºå®šï¼Œå¸Œæœ›åŠ é€Ÿåç»­è¯·æ±‚
- éœ€è¦ç¦»çº¿ä½¿ç”¨å·²ç¼“å­˜çš„é¡µé¢èµ„æº
- éœ€è¦ä¿®æ”¹å‰ç«¯æ–‡ä»¶

```python
# ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼šä¿å­˜ç¼“å­˜
{'url': 'https://example.com', 'key_save': True}

# åç»­è¯·æ±‚ï¼šä½¿ç”¨ç¼“å­˜
{'url': 'https://example.com', 'key': 'aHR0cHM6Ly9leGFtcGxlLmNvbQ=='}
```

---

### session_id ä¼šè¯ä¿æŒ

session_id ç”¨äºåœ¨å¤šæ¬¡è¯·æ±‚ä¹‹é—´ä¿æŒåŒä¸€ä¸ªæµè§ˆå™¨æ ‡ç­¾é¡µçš„çŠ¶æ€ï¼ˆCookiesã€ç™»å½•æ€ç­‰ï¼‰ï¼Œå®ç°ä¼šè¯ä¿æŒã€‚

**å·¥ä½œåŸç†ï¼š**
- é¦–æ¬¡è¯·æ±‚æºå¸¦ `session_id` æ—¶ï¼Œä¼šå°†è¯¥æ ‡ç­¾é¡µä¸æ­¤ ID ç»‘å®š
- åç»­æºå¸¦ç›¸åŒ `session_id` çš„è¯·æ±‚ä¼šå¤ç”¨åŒä¸€æ ‡ç­¾é¡µ
- æ ‡ç­¾é¡µä¼šåœ¨ `MAX_AFTER_REQUEST_SESSION_TIME`ï¼ˆé»˜è®¤150ç§’ï¼‰æ— è¯·æ±‚åè‡ªåŠ¨é‡Šæ”¾

**ç›¸å…³å‚æ•°ï¼š**

| å‚æ•°         | ä½œç”¨                                                           |
| ------------ | -------------------------------------------------------------- |
| session_id   | ä¼šè¯æ ‡è¯†ç¬¦ï¼ˆå¿…é¡»ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼‰                                 |
| init_session | é¦–æ¬¡åˆ›å»ºä¼šè¯æ—¶çš„åˆå§‹åŒ–å‚æ•°ï¼Œç»“æ„ä¸åŸºç¡€å‚æ•°ç›¸åŒ                 |

**ä½¿ç”¨åœºæ™¯ï¼š**
- RPCè°ƒç”¨å‡½æ•°
- éœ€è¦ä¼šè¯ä¿æŒçš„é¡µé¢

```python
# ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼šè§¦å‘ç¿»é¡µæŒ‰é’®ï¼Œå°†å¯¹åº”çš„å‡½æ•°æš´éœ²åˆ°windowä¸­
{
    'session_id': 'my_session_001',
    'init_session': {
        'url': 'https://example.com/login',
        'script': [{'pattern': 'c:#next_page', 'function': 'click'}]
    }
}

# åç»­è¯·æ±‚ï¼šå¤ç”¨æš´éœ²åˆ°windowä¸­çš„å‡½æ•°
{
    'session_id': 'my_session_001',
    'url': 'https://example.com/dashboard',
    'script':[{'run_js':'window.next_page()'}]
}
```

---

### run_time ä¸ run_time_enable çš„åŒºåˆ«

è¿™ä¸¤ä¸ªå‚æ•°å®¹æ˜“æ··æ·†ï¼Œä½†ä½œç”¨ä¸åŒï¼š

| å‚æ•°            | ä½œç”¨                                                                 |
| --------------- | -------------------------------------------------------------------- |
| run_time        | æ˜¯å¦éœ€è¦æ‰§è¡Œ JS è„šæœ¬ã€‚è®¾ä¸º True æ—¶æ‰èƒ½ä½¿ç”¨ script ä¸­çš„ `run_js`      |
| run_time_enable | æ˜¯å¦å¯ç”¨ CDP Runtime.enableã€‚æ§åˆ¶æ˜¯å¦ç›‘å¬ JS æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆé»˜è®¤ Trueï¼‰ |

**ç®€å•ç†è§£ï¼š**
- `run_time`: å¼€å…³ï¼Œå†³å®š"è¦ä¸è¦æ‰§è¡Œ JS"
- `run_time_enable`: é«˜çº§é€‰é¡¹ï¼Œæ§åˆ¶ JS æ‰§è¡Œçš„åº•å±‚æœºåˆ¶

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåªéœ€å…³æ³¨ `run_time`ï¼Œ`run_time_enable` ä¿æŒé»˜è®¤å³å¯ã€‚

---

### å…ƒç´ åŒ¹é…è¯­æ³•

æœ¬é¡¹ç›®åŸºäº DrissionPageï¼Œå…ƒç´ åŒ¹é…è¯­æ³•ä¸å…¶ä¸€è‡´ã€‚å¸¸ç”¨å‰ç¼€ï¼š

| å‰ç¼€ | è¯´æ˜         | ç¤ºä¾‹                                             |
| ---- | ------------ | ------------------------------------------------ |
| `c:` | CSS é€‰æ‹©å™¨   | `c:#id`ã€`c:.class`ã€`c:div.btn`                 |
| `x:` | XPath è¡¨è¾¾å¼ | `x://div[@id="main"]`ã€`x://span[text()="ç¡®å®š"]` |

æ›´å¤šè¯­æ³•è¯¦è§ [DrissionPage æ–‡æ¡£](https://www.drissionpage.cn/ChromiumPage/ele)

---

### wait_urls è¯¦è§£

wait_urls æ”¯æŒä¸¤ç§æ ¼å¼ï¼š

**1. å­—ç¬¦ä¸²æ ¼å¼**

```python
'wait_urls': ['**cap_union_new_getcapbysig**']
```

**2. å­—å…¸æ ¼å¼**

| å‚æ•°          | ç±»å‹        | è¯´æ˜                                                                           |
| ------------- | ----------- | ------------------------------------------------------------------------------ |
| url           | string      | åŒ¹é…çš„é“¾æ¥                                                                     |
| abort         | bool        | æ˜¯å¦æˆªæ–­è¯¥é“¾æ¥çš„è¯·æ±‚(é»˜è®¤False)                                                |
| fill_data     | string/dict | å°†åŒ¹é…åˆ°çš„é“¾æ¥å¡«å……fill_dataä¸­çš„æ•°æ®åŒ…                                          |
| amount        | int         | ç­‰å¾…è¯¥é“¾æ¥çš„æœ€å°æ•°é‡                                                           |
| keep_proxy    | bool        | ä¿æŒä»£ç†(**ä¿æŒä»£ç†çš„è¯·æ±‚å°†é€šè¿‡Fetchè¯·æ±‚ï¼Œå¹¶éæµè§ˆå™¨è¯·æ±‚**)                    |
| status_code   | int         | æ›¿æ¢çŠ¶æ€ç (**å¦‚æœæœ¬æ¥å“åº”çš„è¯·æ±‚çŠ¶æ€ç ä¸º3å¼€å¤´æ—¶åˆ™ä¸äºˆæ›¿æ¢**)                    |
| random_ja3    | bool        | æ˜¯å¦ä½¿ç”¨éšæœºæŒ‡çº¹(**ä»…æ”¯æŒä¸`keep_proxy`ä¸€åŒä½¿ç”¨**)                             |
| impersonate   | string      | æŒ‡å®šTLSæŒ‡çº¹æ¨¡æ‹Ÿ(**ä»…æ”¯æŒä¸`keep_proxy`ä¸€åŒä½¿ç”¨ï¼Œé»˜è®¤chrome120**)               |
| headers       | dict        | æŒ‡å®šå“åº”å¤´(**ä»…æ”¯æŒä¸`fill_data`æˆ–`keep_proxy`ä¸€åŒä½¿ç”¨**)                      |
| body          | string      | åŒ¹é…è¯·æ±‚ä½“çš„æ¨¡å¼ï¼ˆç”¨äºåŒºåˆ†ç›¸åŒURLä½†è¯·æ±‚ä½“ä¸åŒçš„è¯·æ±‚ï¼‰                          |
| fill_amount   | int         | å¡«å……æ•°æ®åŒ…çš„æ¬¡æ•°(**ä»…æ”¯æŒä¸`fill_data`ä¸€åŒä½¿ç”¨ï¼Œé»˜è®¤99**)                      |
| fill_data_b64 | bool        | å¡«å……çš„æ•°æ®åŒ…æ˜¯å¦Base64ç¼–ç (**ä»…æ”¯æŒä¸`fill_data`ä¸€åŒä½¿ç”¨**)                    |
| modify        | dict        | åŠ¨æ€ä¿®æ”¹å“åº”å†…å®¹(**å‚æ•°be_replace:è¢«æ›¿æ¢çš„å­—ç¬¦ä¸²ï¼Œå‚æ•°to_replace:æ›¿æ¢çš„å­—ç¬¦ä¸²**) |
| get_response  | bool        | è¿”å›å“åº”å†…å®¹                                                                   |

```python
'wait_urls': [
    {
        'url': 'https://example.com/api/**',
        'fill_data': "{'result': 'æµ‹è¯•'}",
        'body': '**id=**'
    }
]
```

---

### ensure_eles è¯¦è§£

| å‚æ•°           | ç±»å‹   | è¯´æ˜                                                       |
| -------------- | ------ | ---------------------------------------------------------- |
| pattern        | string | åŒ¹é…çš„å…ƒç´ ï¼Œä¸DPä¸­çš„è§„åˆ™ä¸€è‡´                               |
| ensure_txt_len | int    | ç¡®ä¿åŒ¹é…çš„å…ƒç´ ä¸‹çš„æ–‡æœ¬é•¿åº¦(é»˜è®¤0) PSï¼šæŒ‡çš„æ˜¯è¯¥å…ƒç´ ä¸‹çš„æ‰€æœ‰æ–‡æœ¬ |

```python
'ensure_eles': [
    {'pattern': 'c:div#contentFrame', 'ensure_txt_len': 2},
    {'pattern': 'c:span[ng-bind="enquiry.name"]', 'ensure_txt_len': 2},
]
```

---

### script è¯¦è§£

| å‚æ•°         | ç±»å‹   | è¯´æ˜                                                                         |
| ------------ | ------ | ---------------------------------------------------------------------------- |
| pattern      | string | åŒ¹é…çš„å…ƒç´ ï¼Œä¸DPä¸­çš„è§„åˆ™ä¸€è‡´                                                 |
| function     | string | å¯¹åŒ¹é…çš„å…ƒç´ è¿›è¡Œçš„æ“ä½œ(æ”¯æŒclick/double_click/input)                         |
| value        | string | inputä¸­è¦è¾“å…¥çš„å€¼ï¼ˆå½“valueä¸º'activate'æ—¶ä¼šåˆ›å»ºä¸´æ—¶æ–‡ä»¶ç”¨äºæ–‡ä»¶ä¸Šä¼ ï¼‰         |
| by_js        | bool   | clickæ—¶æ˜¯å¦ä½¿ç”¨jsç‚¹å‡»(é»˜è®¤False)                                             |
| after_iframe | bool   | æ˜¯å¦åœ¨iframeä¸­æŸ¥æ‰¾å…ƒç´ ï¼ˆéœ€é…åˆ`iframe_ele`ä½¿ç”¨ï¼‰                             |
| run_js       | string | é¡µé¢æ‰§è¡Œçš„jsè¯­å¥ PSï¼š**ä½¿ç”¨run_jsæ—¶å¿…é¡»ç¡®ä¿å‚æ•°run_timeä¸ºTrue**              |
| wait_async   | bool   | run_jsæ—¶æ˜¯å¦ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆ(é»˜è®¤False)                                      |
| suffix       | string | inputä¸ºactivateæ—¶çš„æ–‡ä»¶åç¼€(é»˜è®¤jpg)                                         |

```python
'script': [
    {'pattern': 'c:span.tabs-item:nth-of-type(3)', 'function': 'click'},
    {'pattern': 'c:span.btn-name', 'function': 'click', 'by_js': True},
    {'pattern': 'c:input#username', 'function': 'input', 'value': 'test'},
    {'run_js': 'document.title', 'wait_async': False}
]
```

---

## è¿”å›å€¼ç»“æ„

æ¥å£è¿”å› JSON æ ¼å¼æ•°æ®ï¼Œç»“æ„å¦‚ä¸‹ï¼š

**æˆåŠŸæ—¶ï¼š**

```json
{
    "status": "success",
    "text": "<html>...</html>",
    "key": "aHR0cHM6Ly9leGFtcGxlLmNvbQ==",
    "wait_urls": [
        {"url": "https://example.com/api/data", "data": "...", "headers": {...}, "method": "GET"}
    ],
    "wait_eles": {
        "c:div#content": {"load": true, "txt_len": 100}
    },
    "js_result": [
        {"js": "document.title", "result": "\"é¡µé¢æ ‡é¢˜\""}
    ],
    "cookies": {"session": "xxx", "token": "yyy"},
    "session_storage": {"key1": "value1"},
    "local_storage": {"key2": "value2"},
    "keep_proxy": {"http": "http://proxy:port", "https": "http://proxy:port"},
    "error_reason": null,
    "step_spend_time": {
        "get_chrome_time": 0.05,
        "init_chrome": 0.01,
        "get_url": 1.23,
        "_total": 2.5
    }
}
```

**å¤±è´¥æ—¶ï¼š**

```json
{
    "status": "fail",
    "message": "è¶…æ—¶äº†",
    "error_reason": "æ¡ä»¶{'pattern': 'c:#not-exist'}ä¸æ»¡è¶³",
    "step_spend_time": {...}
}
```

**å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ            | è¯´æ˜                                                   |
| --------------- | ------------------------------------------------------ |
| status          | è¯·æ±‚çŠ¶æ€ï¼š`success` æˆ– `fail`                          |
| text            | é¡µé¢ HTMLï¼ˆéœ€è®¾ç½® `html: true`ï¼‰                       |
| key             | ç¼“å­˜ keyï¼ˆä½¿ç”¨æˆ–ç”Ÿæˆçš„ï¼‰                               |
| wait_urls       | æ‹¦æˆªåˆ°çš„è¯·æ±‚åˆ—è¡¨                                       |
| wait_eles       | ç­‰å¾…å…ƒç´ çš„åŠ è½½çŠ¶æ€                                     |
| js_result       | JS æ‰§è¡Œç»“æœåˆ—è¡¨                                        |
| cookies         | é¡µé¢ Cookiesï¼ˆéœ€è®¾ç½® `cookies: true`ï¼‰                 |
| session_storage | é¡µé¢ sessionStorageï¼ˆéœ€è®¾ç½® `session_storage: true`ï¼‰  |
| local_storage   | é¡µé¢ localStorageï¼ˆéœ€è®¾ç½® `local_storage: true`ï¼‰      |
| keep_proxy      | ä¿æŒçš„ä»£ç† IPï¼ˆä½¿ç”¨ `keep_proxy` æ—¶è¿”å›ï¼‰              |
| error_reason    | å¤±è´¥åŸå›                                                |
| step_spend_time | å„æ­¥éª¤è€—æ—¶ç»Ÿè®¡                                         |
| message         | å¤±è´¥æ—¶çš„é”™è¯¯ä¿¡æ¯                                       |



## Web UI ç¼“å­˜ç®¡ç†

æœåŠ¡å¯åŠ¨åï¼Œè®¿é—® `http://127.0.0.1:{ç«¯å£}/cache` å¯æ‰“å¼€ç¼“å­˜ç®¡ç†ç•Œé¢ã€‚

![ç¼“å­˜ç®¡ç†ç•Œé¢](https://github.com/Markrof3/LessPageEngineer/blob/dev/assets/ui.png?raw=true)

**åŠŸèƒ½è¯´æ˜ï¼š**

| åŠŸèƒ½ | è¯´æ˜ |
| --- | --- |
| æŸ¥çœ‹ç¼“å­˜ | å·¦ä¾§åˆ—è¡¨æ˜¾ç¤ºæ‰€æœ‰ç¼“å­˜ keyï¼Œç‚¹å‡»æŸ¥çœ‹è¯¦æƒ… |
| æœç´¢ URL | åœ¨ URL åˆ—è¡¨ä¸Šæ–¹æœç´¢æ¡†ä¸­è¾“å…¥å…³é”®è¯ï¼Œå¯æœç´¢ URLã€Headersã€Body |
| ç¼–è¾‘ç¼“å­˜ | ä¿®æ”¹ Status Codeã€Headersã€Body åç‚¹å‡»ä¿å­˜ |
| æ·»åŠ  URL | ç‚¹å‡»"æ·»åŠ  URL"æŒ‰é’®ï¼Œå¡«å†™ URLã€çŠ¶æ€ç ã€å“åº”å¤´ã€å“åº”ä½“ |
| åˆ é™¤ URL | ç‚¹å‡» URL è¯¦æƒ…ä¸­çš„"åˆ é™¤æ­¤ URL"æŒ‰é’® |
| åˆ é™¤ç¼“å­˜ | ç‚¹å‡»å³ä¸Šè§’"åˆ é™¤"æŒ‰é’®åˆ é™¤æ•´ä¸ªç¼“å­˜ |

---

## ç¢ç¢å¿µ

é¦–å…ˆè¦æ„Ÿè°¢`DrissionPage`ä½œè€…å¼€æº`DrissionPage`

é¡¹ç›®å¼€å§‹äº24å¹´10æœˆï¼Œç»è¿‡åŠå¹´çš„æ›´æ–°è¿­ä»£ï¼Œä»¥åŠå¤§åŠå¹´çš„åœæ»æ›´æ–°ï¼Œå°±åˆ°ç°åœ¨äº†(25å¹´12æœˆ)

å¸Œæœ›è¿™ä¸ªé¡¹ç›®èƒ½è®©å¤§å®¶å°‘æ‰ç‚¹å¤´å‘